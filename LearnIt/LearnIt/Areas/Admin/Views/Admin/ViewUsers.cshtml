

@model IEnumerable<UserViewModel>


<h2>Search user</h2>




<div class="ui-widget">
    <label for="UserView"> Input Username: </label>
    <input id="UserView" placeholder="It will autocomplete it">
</div>


<div id="hiddenSearch">
    @Ajax.ActionLink("Admin", "LoadUser",
       new { username = "ThisPartIsReplacedLater" },
       new AjaxOptions
       {
           InsertionMode = InsertionMode.Replace,
           UpdateTargetId = "generateUserArea"
       });
</div>

<div id="generateUserArea">

</div>


@section scripts {
    @Scripts.Render("~/bundles/jqueryajax")
}
<script>
    $(document).ready(() => {
        let jsonModel = '@Html.Raw(Json.Encode(Model))';
        let modelLenght = '@Model.Count()';
        let model = JSON.parse(jsonModel);
        let names = [];
        for (let i = 0; i < modelLenght; i += 1) {
            names.push(model[i].Username);
        }
        $("#UserView").autocomplete({
            source: names
        });
        $(window).keydown(function (e) {
            if (e.which == 13) {
                $("#UserView").keyup(function (e){
                    if (e.which == 13 &&
                        !(names.indexOf($("#UserView").val()) === -1)) {

                        let cleanUrl = $('#hiddenSearch a').attr('href')
                                       .substring(0, $('#hiddenSearch a').attr('href').indexOf('?username=') + 10);

                        let searchUrl = cleanUrl + $("#UserView").val();
                        $('#hiddenSearch a').attr("href", searchUrl)
                        $('#hiddenSearch a').click();
                    }
                });
            }
        });
    });

</script>
